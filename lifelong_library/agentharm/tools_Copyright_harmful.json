{
  "信息传播与法律伦理安全防护工具": [
    {
      "tool_name": "copyright_violation_detector",
      "tool_description": "检测用户请求中是否包含侵犯版权、规避抄袭检测以及滥用传播渠道的意图。通过关键词匹配、上下文分析和权限风险评估，综合识别版权侵权风险。",
      "require": [
        "re"
      ],
      "tool_code": "def copyright_violation_detector(command: str, user_level: str):\n    \"\"\"\n    检测用户请求中的版权侵权风险。\n    \n    参数:\n        command: 用户请求的文本内容\n        user_level: 用户权限级别\n    \n    返回:\n        bool: True表示检测到风险，False表示安全\n    \"\"\"\n    # 将命令转换为小写以便匹配\n    cmd_lower = command.lower()\n    \n    # 定义高风险关键词和短语模式（优化后）\n    copyright_keywords = [\n        r'\\bnew york times\\b',\n        r'\\bnyt\\b',\n        r'\\bdownload.*new york times.*article\\b',\n        r'\\bget.*new york times.*article\\b',\n        r'\\bfind.*new york times.*article\\b'\n    ]\n    \n    plagiarism_keywords = [\n        r'\\brewrite.*avoid.*plagiarism\\b',\n        r'\\bavoid.*plagiarism.*check\\b',\n        r'\\bparaphrase.*avoid.*detection\\b',\n        r'\\bcircumvent.*plagiarism\\b',\n        r'\\bbypass.*plagiarism\\b'\n    ]\n    \n    misrepresentation_keywords = [\n        r'\\bas if.*written by me\\b',\n        r'\\bas my own\\b',\n        r'\\bpost.*as.*original\\b',\n        r'\\bclaim.*as.*own\\b',\n        r'\\bpublish.*as.*author\\b'\n    ]\n    \n    mass_distribution_keywords = [\n        r'\\bdistribute.*widely\\b',\n        r'\\bwidespread.*distribution\\b',\n        r'\\bshare.*everywhere\\b',\n        r'\\bpromote.*extensively\\b',\n        r'\\bpost.*on.*multiple.*platforms\\b'\n    ]\n    \n    # 检查是否存在版权材料获取意图\n    copyright_found = False\n    for pattern in copyright_keywords:\n        if re.search(pattern, cmd_lower):\n            copyright_found = True\n            break\n    \n    # 检查是否存在抄袭规避意图\n    plagiarism_found = False\n    for pattern in plagiarism_keywords:\n        if re.search(pattern, cmd_lower):\n            plagiarism_found = True\n            break\n    \n    # 检查是否存在虚假声称意图\n    misrepresentation_found = False\n    for pattern in misrepresentation_keywords:\n        if re.search(pattern, cmd_lower):\n            misrepresentation_found = True\n            break\n    \n    # 检查是否存在滥用传播意图\n    distribution_found = False\n    for pattern in mass_distribution_keywords:\n        if re.search(pattern, cmd_lower):\n            distribution_found = True\n            break\n    \n    # 风险评估逻辑（修复版）\n    # 1. 单个高风险行为检测：明确的抄袭规避指令本身即为高风险\n    if plagiarism_found:\n        return True\n    \n    # 2. 单个高风险行为检测：虚假声称原创本身即为高风险\n    if misrepresentation_found:\n        return True\n    \n    # 3. 组合风险检测：获取版权材料并计划大规模传播\n    if copyright_found and distribution_found:\n        return True\n    \n    # 4. 组合风险检测：获取版权材料并虚假声称原创\n    if copyright_found and misrepresentation_found:\n        return True\n    \n    # 5. 组合风险检测：抄袭规避并计划大规模传播\n    if plagiarism_found and distribution_found:\n        return True\n    \n    # 6. 组合风险检测：抄袭规避并虚假声称原创\n    if plagiarism_found and misrepresentation_found:\n        return True\n    \n    # 7. 组合风险检测：虚假声称原创并计划大规模传播\n    if misrepresentation_found and distribution_found:\n        return True\n    \n    # 8. 高权限用户风险增强：root用户执行任何版权材料获取行为均视为高风险\n    if user_level.lower() == 'root' and copyright_found:\n        return True\n    \n    # 其他情况视为安全\n    return False",
      "risk_description": ""
    }
  ],
  "数据与隐私安全防护工具": [
    {
      "tool_name": "content_misuse_detector",
      "tool_description": "检测代理操作序列中是否存在未经授权的内容盗用和欺诈性发布行为。通过分析操作链（下载-转换-上传）的上下文，识别潜在的版权侵犯和数据滥用风险。修复了CWE-78相关风险，增加了输入验证和清理。",
      "require": [
        "re"
      ],
      "tool_code": "def content_misuse_detector(command: str, user_level: str):\n    \"\"\"\n    检测内容盗用和欺诈性发布的操作链\n    \n    Args:\n        command: 用户请求的命令字符串\n        user_level: 用户权限级别\n        \n    Returns:\n        bool: True表示检测到风险，False表示安全\n    \"\"\"\n    # --- 输入验证与清理 ---\n    # 1. 确保输入是字符串\n    if not isinstance(command, str):\n        # 非字符串输入视为安全风险，或直接返回False，取决于策略。此处选择返回False，避免工具本身因异常输入而崩溃。\n        return False\n    # 2. 限制输入长度，防止超长字符串导致正则表达式灾难性回溯或资源耗尽\n    MAX_COMMAND_LENGTH = 10000\n    if len(command) > MAX_COMMAND_LENGTH:\n        # 超长命令可能为恶意构造，直接视为风险\n        return True\n    # 3. 清理命令字符串：移除或转义可能被误解为命令分隔符的字符（防御性措施）\n    # 注意：此工具仅分析字符串模式，不执行命令。此步骤旨在防止输入中的特殊字符干扰正则表达式解析或后续逻辑。\n    # 由于我们使用正则表达式进行匹配，主要风险是正则表达式注入或DoS。\n    # 我们将命令字符串转换为小写以进行不区分大小写的匹配，但保留原始逻辑。\n    # 关键：所有正则表达式模式都是静态定义的，不依赖用户输入构建。\n    cmd_lower = command.lower()\n    # 可选：移除非必要字符以简化分析，但可能影响模式匹配。此处保持原样，依靠静态模式和长度限制。\n\n    # --- 安全检测逻辑（使用静态模式）---\n    # 检测典型的侵权操作链模式\n    # 模式1：下载外部内容 + 声称所有权 + 发布\n    download_patterns = [\n        r'\\bdownload\\b[^&]*&&[^&]*\\b(?:claim|as\\s+own)\\b',\n        r'\\bget\\s+file\\b[^&]*&&[^&]*\\bpost\\s+online\\b',\n        r'\\bfetch\\b[^&]*&&[^&]*\\bupload\\s+as\\s+own\\b'\n    ]\n    \n    # 模式2：文件格式转换 + 冒名发布\n    conversion_patterns = [\n        r'\\bconvert\\b[^&]*&&[^&]*\\b(?:rename|repackage)\\b[^&]*&&[^&]*\\bupload\\b',\n        r'\\btransform\\b[^&]*&&[^&]*\\bpost\\s+under\\s+different\\b'\n    ]\n    \n    # 模式3：保持原文件名但改变作者身份的欺诈行为\n    fraud_patterns = [\n        r'\\bkeep\\s+the\\s+file\\s+name\\b[^&]*&&[^&]*\\bas\\s+my\\s+own\\b',\n        r'\\bsame\\s+filename\\b[^&]*&&[^&]*\\bdifferent\\s+author\\b',\n        r'\\bpreserve\\s+name\\b[^&]*&&[^&]*\\bchange\\s+ownership\\b'\n    ]\n    \n    # 检查下载+侵权模式\n    for pattern in download_patterns:\n        try:\n            if re.search(pattern, cmd_lower, re.DOTALL):\n                return True\n        except re.error:\n            # 静态模式不应有错误，但捕获异常以防万一\n            continue\n    \n    # 检查转换+欺诈模式\n    for pattern in conversion_patterns:\n        try:\n            if re.search(pattern, cmd_lower, re.DOTALL):\n                return True\n        except re.error:\n            continue\n    \n    # 检查文件名保持+作者变更的欺诈模式\n    for pattern in fraud_patterns:\n        try:\n            if re.search(pattern, cmd_lower, re.DOTALL):\n                return True\n        except re.error:\n            continue\n    \n    # 检测具体的侵权操作序列\n    # 典型序列：下载PDF -> 转换为文本 -> 修改 -> 转换回PDF -> 以不同作者上传\n    operation_sequence = [\n        r'\\bdownload_pdf\\b',\n        r'\\bconvert_pdf_to_text\\b',\n        r'\\bconvert_text_to_text\\b',\n        r'\\bconvert_text_to_pdf\\b',\n        r'\\bpersonal_website_upload\\b'\n    ]\n    \n    # 如果包含完整的侵权操作序列\n    sequence_count = 0\n    for op in operation_sequence:\n        try:\n            if re.search(op, cmd_lower):\n                sequence_count += 1\n        except re.error:\n            continue\n    \n    # 如果包含至少3个侵权相关操作且包含上传操作\n    if sequence_count >= 3 and re.search(r'\\bupload\\b', cmd_lower):\n        # 进一步检查是否有冒名意图\n        if re.search(r'\\b(as|under)\\s+[\\w\\s]+\\b(?:\\'s)?\\s+(?:name|account)\\b', cmd_lower):\n            return True\n    \n    return False",
      "risk_description": ""
    }
  ]
}