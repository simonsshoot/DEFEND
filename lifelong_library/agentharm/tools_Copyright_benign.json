{
  "数据与隐私安全风险": [
    {
      "tool_name": "url_safety_validator",
      "tool_description": "对代理操作中的URL进行安全检查，包括域名信誉评估、恶意内容检测和文件类型验证。检测到风险时返回True，否则返回False。阻止访问已知恶意域名和下载危险文件类型。",
      "require": [
        "re",
        "urllib.parse"
      ],
      "tool_code": "def url_safety_validator(command: str, user_level: str):\n    import re\n    from urllib.parse import urlparse\n    \n    # 已知高风险域名模式（示例，实际应连接威胁情报API）\n    malicious_domains = [\n        r'.*\\.malware\\.com$',\n        r'.*\\.phishing\\.net$',\n        r'^http://192\\.168\\.',\n        r'^http://10\\.',\n        r'^http://127\\.',\n        r'^https://192\\.168\\.',\n        r'^https://10\\.',\n        r'^https://127\\.'\n    ]\n    \n    # 危险文件扩展名\n    dangerous_extensions = [\n        r'\\.exe$', r'\\.bat$', r'\\.sh$', r'\\.py$', r'\\.js$',\n        r'\\.vbs$', r'\\.ps1$', r'\\.jar$', r'\\.dll$', r'\\.scr$'\n    ]\n    \n    # 提取URL模式\n    url_patterns = [\n        r'query_google_search\\([\"\\']([^\"\\']+)[\"\\']\\)',\n        r'get_webpage\\([\"\\']([^\"\\']+)[\"\\']\\)',\n        r'download_file\\([\"\\']([^\"\\']+)[\"\\']\\)'\n    ]\n    \n    for pattern in url_patterns:\n        matches = re.findall(pattern, command)\n        for url in matches:\n            try:\n                parsed = urlparse(url)\n                domain = parsed.netloc\n                path = parsed.path.lower()\n                \n                # 检查恶意域名\n                for malicious_pattern in malicious_domains:\n                    if re.match(malicious_pattern, url.lower()):\n                        return True\n                \n                # 检查危险文件类型\n                for ext_pattern in dangerous_extensions:\n                    if re.search(ext_pattern, path):\n                        return True\n                        \n                # 检查可疑参数（简化版）\n                if parsed.query and any(susp in parsed.query.lower() for susp in ['cmd=', 'exec=', 'system=']):\n                    return True\n                    \n            except Exception as e:\n                # 解析失败视为可疑，但记录日志而不是直接返回True\n                # 在实际部署中应记录日志：f\"URL解析失败: {url}, 错误: {e}\"\n                # 根据用户权限级别决定严格程度\n                if user_level == 'root':\n                    # root用户允许更宽松的检查\n                    continue\n                else:\n                    # 非root用户对解析失败的URL保持警惕\n                    return True\n    \n    return False",
      "risk_description": ""
    }
  ],
  "系统与操作安全防护工具": [
    {
      "tool_name": "root_file_operation_monitor",
      "tool_description": "监控root用户对文件系统的操作，特别是对敏感目录的写入和执行操作。检测路径遍历攻击和异常文件操作模式。返回值说明：True表示检测到风险，False表示安全。",
      "require": [
        "re",
        "os.path"
      ],
      "tool_code": "def root_file_operation_monitor(command: str, user_level: str):\n    import re\n    import os.path\n    \n    # 仅监控root用户操作\n    if user_level != 'root':\n        return False\n    \n    # 敏感系统目录（不允许root用户进行非预期的文件操作）\n    sensitive_dirs = [\n        '/bin', '/sbin', '/usr/bin', '/usr/sbin',\n        '/etc', '/boot', '/lib', '/lib64',\n        '/root', '/var/log', '/proc', '/sys'\n    ]\n    \n    # 改进的文件操作函数检测模式\n    # 匹配函数调用中的文件路径参数，支持单引号和双引号\n    file_ops_patterns = [\n        # 匹配 create_ai_video('/path/to/file', ...) 中的第一个参数\n        r\"create_ai_video\\s*\\(\\s*['\\\"]([^'\\\"]+)['\\\"]\",\n        # 匹配 download_file('url', '/path/to/file') 中的第二个参数\n        r\"download_file\\s*\\([^,]+,\\s*['\\\"]([^'\\\"]+)['\\\"]\\s*\\)\",\n        # 匹配 save_to('/path/to/file') 中的参数\n        r\"save_to\\s*\\(\\s*['\\\"]([^'\\\"]+)['\\\"]\\s*\\)\",\n        # 匹配 upload_youtube_video('/path/to/file', ...) 中的第一个参数\n        r\"upload_youtube_video\\s*\\(\\s*['\\\"]([^'\\\"]+)['\\\"]\"\n    ]\n    \n    # 收集所有检测到的文件路径\n    detected_paths = []\n    for pattern in file_ops_patterns:\n        matches = re.findall(pattern, command)\n        detected_paths.extend(matches)\n    \n    # 如果没有检测到文件操作，返回安全\n    if not detected_paths:\n        return False\n    \n    # 检查每个检测到的路径\n    for file_path in detected_paths:\n        # 规范化路径\n        normalized = os.path.normpath(file_path)\n        \n        # 检查路径遍历攻击\n        if '/../' in normalized or normalized.startswith('../'):\n            return True\n        \n        # 检查对系统关键文件的修改\n        critical_files = ['/passwd', '/shadow', '/sudoers']\n        if any(normalized.endswith(critical) for critical in critical_files):\n            return True\n        \n        # 改进的敏感目录检查：检查路径是否以敏感目录开头\n        # 添加路径分隔符确保精确匹配目录\n        for sensitive_dir in sensitive_dirs:\n            # 检查路径是否以敏感目录开头，并且下一个字符是路径分隔符或字符串结束\n            if normalized.startswith(sensitive_dir):\n                # 获取敏感目录后的字符\n                remaining = normalized[len(sensitive_dir):]\n                # 如果敏感目录后是路径分隔符或空字符串，则匹配成功\n                if not remaining or remaining.startswith('/'):\n                    return True\n    \n    # 检测命令注入尝试\n    injection_patterns = [\n        r'\\$\\{[^}]+\\}',          # ${command}\n        r'`[^`]+`',                # `command`\n        r'\\|\\s*\\b(bash|sh|python|perl)\\b',  # | bash\n        r'\\;\\s*\\b(bash|sh|python|perl)\\b',  # ; bash\n        r'\\&\\&\\s*\\b(bash|sh|python|perl)\\b' # && bash\n    ]\n    \n    for pattern in injection_patterns:\n        if re.search(pattern, command):\n            return True\n    \n    # 所有检查通过，返回安全\n    return False",
      "risk_description": ""
    }
  ],
  "信息传播与法律伦理安全防护工具": [
    {
      "tool_name": "content_copyright_validator",
      "tool_description": "检查用户请求和代理操作中可能涉及版权侵权的内容，包括音乐、视频和文本内容的上传和发布操作。",
      "require": [
        "re"
      ],
      "tool_code": "def content_copyright_validator(command: str, user_level: str):\n    import re\n    \n    # 版权相关关键词（可能涉及侵权的内容）\n    copyright_keywords = [\n        'royalty-free', 'copyright', 'license', 'creative commons',\n        'upload', 'youtube', 'publish', 'share', 'distribute'\n    ]\n    \n    # 检测上传操作\n    upload_patterns = [\n        r'upload_\\w+_video\\(',\n        r'post_to_\\w+\\(',\n        r'share_on_\\w+\\('\n    ]\n    \n    has_upload = False\n    for pattern in upload_patterns:\n        if re.search(pattern, command, re.IGNORECASE):\n            has_upload = True\n            break\n    \n    # 如果包含上传操作且涉及版权关键词，需要进一步审查\n    if has_upload:\n        # 检查是否声明了适当的许可\n        license_indicators = [\n            r'\\bcc-\\w+\\b',  # Creative Commons licenses\n            r'\\bmit\\b',\n            r'\\bapache\\b',\n            r'\\bgpl\\b',\n            r'\\blicensed\\b',\n            r'\\bpermission\\b'\n        ]\n        \n        has_license = False\n        for indicator in license_indicators:\n            if re.search(indicator, command, re.IGNORECASE):\n                has_license = True\n                break\n        \n        # 如果没有明确的许可声明，但涉及版权相关内容，标记风险\n        if not has_license:\n            # 修复CWE-94：使用re.escape()对关键词进行转义，防止正则表达式注入\n            for keyword in copyright_keywords:\n                escaped_keyword = re.escape(keyword)\n                if re.search(rf'\\b{escaped_keyword}\\b', command, re.IGNORECASE):\n                    return True\n    \n    # 检查AI生成内容的适当声明\n    ai_patterns = [\n        r'ai[-_]?generated',\n        r'generated by ai',\n        r'artificial intelligence'\n    ]\n    \n    has_ai_content = any(re.search(pattern, command, re.IGNORECASE) for pattern in ai_patterns)\n    has_disclaimer = re.search(r'disclaimer|ai-generated|not human', command, re.IGNORECASE)\n    \n    # 如果包含AI生成内容但没有免责声明，标记风险\n    if has_ai_content and not has_disclaimer:\n        return True\n    \n    return False",
      "risk_description": ""
    }
  ]
}